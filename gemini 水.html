<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ°´å»å’—é‚Šåº¦ï¼Ÿå°å°ç§‘å­¸å®¶å¯¦é©—</title>
    <style>
        /* ğŸŒˆ è¦–è¦ºå‹å–„è¨­è¨ˆï¼šé«˜å°æ¯”ã€å¤§å­—é«”ã€åœ“è§’ */
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Microsoft JhengHei', 'Heiti TC', sans-serif;
            background-color: #f0f8ff;
            touch-action: none; /* é˜²æ­¢æ‰‹æ©Ÿæ»‘å‹• */
        }

        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ° Canvas */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
            z-index: 10;
        }

        /* é ‚éƒ¨æ¨™é¡Œèˆ‡å•é¡Œ */
        header {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            pointer-events: auto;
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            margin: 0;
            color: #333;
            font-size: 1.5rem;
        }

        p.question {
            margin: 10px 0 0 0;
            color: #555;
            font-size: 1.1rem;
        }

        /* åº•éƒ¨æ§åˆ¶å€ */
        #controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.85);
            padding: 20px;
            border-radius: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
        }

        .btn {
            border: none;
            padding: 15px 20px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            min-width: 100px;
        }

        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.2);
        }

        /* é¡è‰²ç·¨ç¢¼ */
        .btn-cold { background-color: #87CEEB; color: #004d6e; } /* â„ï¸ å†· */
        .btn-room { background-color: #90EE90; color: #1b5e20; } /* ğŸ  å¸¸æº« */
        .btn-hot { background-color: #FFB6C1; color: #880e4f; }  /* â˜€ï¸ ç†± */
        
        .btn-reset-main { 
            background-color: #FFD700; 
            color: #5d4037; 
            display: none; /* å¯¦é©—é–‹å§‹å¾Œé¡¯ç¤º */
        } 

        .btn-quiz {
            background-color: #BA68C8;
            color: #fff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .emoji {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        /* ç‹€æ…‹/ç¸½çµé¡¯ç¤ºæ¡† (Modal) */
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 85%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            pointer-events: auto;
            border: 5px solid #FFD700;
            display: none;
            z-index: 100;
        }

        .modal h2 { margin-top: 0; color: #333; }
        .modal p { font-size: 1.2rem; line-height: 1.6; color: #444; }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        /* æ¸¬é©—ä»‹é¢æ¨£å¼ */
        #quiz-container {
            border-color: #BA68C8;
            display: none;
        }

        .quiz-option {
            background: #fff;
            border: 3px solid #ddd;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .quiz-option:hover { background: #f9f9f9; border-color: #BA68C8; }
        .quiz-option.correct { background: #d4edda; border-color: #28a745; color: #155724; }
        .quiz-option.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; }

        #quiz-progress { font-size: 0.9rem; color: #888; margin-bottom: 10px; }
        #quiz-feedback { font-weight: bold; height: 1.5rem; margin-top: 10px; }

        /* å³ä¸‹è§’å¸¸é§é‡ç½®æŒ‰éˆ• */
        #footer-reset {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.6);
            border: 2px solid #999;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            pointer-events: auto;
            z-index: 50;
        }

        /* å®‰å…¨æç¤ºå°æ¨™ç±¤ */
        #safety-tip {
            position: absolute;
            bottom: 150px;
            right: 20px;
            font-size: 0.9rem;
            color: #666;
            background: rgba(255,255,255,0.8);
            padding: 5px 10px;
            border-radius: 10px;
        }
        
        /* éš±è— */
        .hidden { display: none !important; }

    </style>
    <!-- å¼•å…¥ Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

    <!-- 3D ç•«å¸ƒå®¹å™¨ -->
    <div id="canvas-container"></div>

    <!-- UI å±¤ -->
    <div id="ui-container">
        <header>
            <h1 id="main-title">ğŸ’§ æ°´å»å’—é‚Šåº¦ï¼Ÿ</h1>
            <p class="question" id="main-question">è©¦å“æ€ä¸€å€‹æº«åº¦ï¼Œç‡å“æ¯å…¥é¢å˜…æ°´æœƒç™¼ç”Ÿå’©äº‹ï¼Ÿ</p>
        </header>

        <!-- ç¸½çµ Modal -->
        <div id="summary-modal" class="modal">
            <h2>å¯¦é©—å®Œæˆï¼ğŸ‰</h2>
            <p id="summary-text">æ°´è®Šæˆäº†çœ‹ä¸è¦‹çš„æ°´è’¸æ°£ã€‚</p>
            <div class="modal-buttons">
                <button class="btn btn-reset-main" onclick="resetSim()" style="display:flex;">ğŸ”„ å†ç©ä¸€æ¬¡</button>
                <button class="btn btn-quiz" onclick="startQuiz()">ğŸ§  æŒ‘æˆ°å°æ¸¬é©—</button>
            </div>
        </div>

        <!-- æ¸¬é©— Modal -->
        <div id="quiz-modal" class="modal" style="border-color: #BA68C8;">
            <div id="quiz-progress">å•é¡Œ 1 / 4</div>
            <h2 id="quiz-question" style="font-size: 1.3rem;">é¡Œç›®åœ¨é€™è£¡</h2>
            <div id="quiz-options">
                <!-- é¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div id="quiz-feedback"></div>
        </div>

        <!-- æ¸¬é©—çµæœ Modal -->
        <div id="result-modal" class="modal" style="border-color: #4CAF50;">
            <h2>æŒ‘æˆ°æˆåŠŸï¼ğŸŒŸ</h2>
            <p id="result-text">ä½ æ˜¯å°å°ç§‘å­¸å®¶ï¼</p>
            <div class="modal-buttons">
                <button class="btn btn-reset-main" onclick="resetSim()" style="display:flex; background-color: #4CAF50; color: white;">ğŸ  è¿”å›é¦–é </button>
            </div>
        </div>

        <div id="safety-tip">ğŸ’¡ æç¤ºï¼šåšå¯¦é©—è¦è½è€å¸«è©±å‘€ï¼</div>

        <div id="controls">
            <button class="btn btn-cold temp-btn" onclick="startSim('cold')">
                <span class="emoji">â„ï¸</span>
                ä¼¼å†¬å¤© (å‡)
            </button>
            <button class="btn btn-room temp-btn" onclick="startSim('room')">
                <span class="emoji">ğŸ </span>
                ä¼¼æˆ¿ä»” (å¸¸æº«)
            </button>
            <button class="btn btn-hot temp-btn" onclick="startSim('hot')">
                <span class="emoji">â˜€ï¸</span>
                ä¼¼å¤å¤© (ç†±)
            </button>
            <!-- å¯¦é©—é€²è¡Œä¸­é¡¯ç¤ºçš„é‡ç½®æŒ‰éˆ• -->
            <button class="btn btn-reset-main" id="sim-reset-btn" onclick="resetSim()">
                <span class="emoji">ğŸ”„</span>
                åœæ­¢
            </button>
        </div>
    </div>

    <!-- å³ä¸‹è§’å¸¸é§é‡ç½®å°æŒ‰éˆ• -->
    <div id="footer-reset" onclick="resetSim()" title="å…¨éƒ¨é‡ç½®">ğŸ”„</div>

    <script>
        // --- 1. Three.js èˆ‡å¯¦é©—è®Šæ•¸ ---
        let scene, camera, renderer;
        let cup, water, ground;
        let particles = [];
        let isSimulating = false;
        let evaporationSpeed = 0;
        let waterLevel = 1.0; 
        let tempType = 'room';

        // --- 2. æ¸¬é©—è³‡æ–™ (åˆéš x2, é«˜éš x2) ---
        const quizData = [
            {
                level: "åˆéš",
                q: "å¤©æ°£è¶Šç†±ï¼Œæ°´è’¸ç™¼å¾—è¶Š...ï¼Ÿ",
                options: [
                    { text: "è¶Šå¿« ğŸ‡", correct: true },
                    { text: "è¶Šæ…¢ ğŸ¢", correct: false }
                ],
                feedback: "å•±å•¦ï¼æº«åº¦é«˜ï¼Œæ°´èµ°å¾—å¿«ï¼"
            },
            {
                level: "åˆéš",
                q: "æ°´è®Šæˆæ°´è’¸æ°£ä¹‹å¾Œï¼Œçœ¼ç›é‚„çœ‹å¾—åˆ°å—ï¼Ÿ",
                options: [
                    { text: "çœ‹å¾—åˆ° ğŸ‘€", correct: false },
                    { text: "çœ‹ä¸è¦‹ ğŸ‘»", correct: true }
                ],
                feedback: "ä¿‚å‘€ï¼æ°´è’¸æ°£ä¿‚é€æ˜ç‡å””åˆ°æ¶ã€‚"
            },
            {
                level: "é«˜éš",
                q: "ç‚ºä»€éº¼å†¬å¤©çš„è¡£æœæ¯”è¼ƒé›£ä¹¾ï¼Ÿ",
                options: [
                    { text: "å› ç‚ºé¢¨å¤ªå¤§ ğŸŒ¬ï¸", correct: false },
                    { text: "å› ç‚ºå¤©æ°£å‡ â„ï¸", correct: true }
                ],
                feedback: "ç„¡éŒ¯ï¼å¤©æ°£å‡ï¼Œæ°´è’¸ç™¼å¾—æ…¢ã€‚"
            },
            {
                level: "é«˜éš",
                q: "æ¯è£¡çš„æ°´è®Šå°‘äº†ï¼Œå®ƒæ˜¯çœŸçš„æ¶ˆå¤±äº†å—ï¼Ÿ",
                options: [
                    { text: "è·‘åˆ°ç©ºæ°£è£¡äº† â˜ï¸", correct: true },
                    { text: "è¢«æ¯å­åƒæ‰äº† ğŸ¥¤", correct: false }
                ],
                feedback: "å¥½å»å‘€ï¼æ°´è®Šåšæ°´è’¸æ°£å…¥å’—ç©ºæ°£åº¦ã€‚"
            }
        ];

        let currentQuizIndex = 0;
        let quizScore = 0;

        // --- 3. åˆå§‹åŒ–èˆ‡ 3D å ´æ™¯ ---
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe0f7fa);

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 3, 6);
            camera.lookAt(0, 1, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 10, 7);
            scene.add(dirLight);

            // åœ°æ¿
            const groundGeo = new THREE.CylinderGeometry(4, 4, 0.2, 32);
            const groundMat = new THREE.MeshLambertMaterial({ color: 0x8d6e63 });
            ground = new THREE.Mesh(groundGeo, groundMat);
            ground.position.y = -0.1;
            scene.add(ground);

            // æ¯å­
            const cupGeo = new THREE.CylinderGeometry(1.1, 1.1, 2.5, 32, 1, true);
            const cupMat = new THREE.MeshPhongMaterial({ color: 0xffffff, opacity: 0.3, transparent: true, side: THREE.DoubleSide });
            cup = new THREE.Mesh(cupGeo, cupMat);
            cup.position.y = 1.25;
            scene.add(cup);

            const cupBaseGeo = new THREE.CircleGeometry(1.1, 32);
            const cupBase = new THREE.Mesh(cupBaseGeo, cupMat);
            cupBase.rotation.x = -Math.PI / 2;
            scene.add(cupBase);

            // æ°´
            const waterGeo = new THREE.CylinderGeometry(1.05, 1.05, 2.0, 32);
            waterGeo.translate(0, 1.0, 0);
            const waterMat = new THREE.MeshPhongMaterial({ color: 0x2196F3, transparent: true, opacity: 0.8 });
            water = new THREE.Mesh(waterGeo, waterMat);
            water.position.y = 0.05;
            scene.add(water);

            // åˆ»åº¦
            for(let i=1; i<=4; i++) {
                const lineGeo = new THREE.TorusGeometry(1.12, 0.02, 16, 32);
                const lineMat = new THREE.MeshBasicMaterial({ color: 0x333333 });
                const line = new THREE.Mesh(lineGeo, lineMat);
                line.rotation.x = Math.PI / 2;
                line.position.y = i * 0.5;
                scene.add(line);
            }

            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function createParticle() {
            const pGeo = new THREE.SphereGeometry(0.1, 8, 8);
            const pMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.6 });
            const p = new THREE.Mesh(pGeo, pMat);
            
            const x = (Math.random() - 0.5) * 1.5;
            const z = (Math.random() - 0.5) * 1.5;
            const startY = water.position.y + (2.0 * waterLevel); 
            
            p.position.set(x, startY, z);
            scene.add(p);
            
            particles.push({
                mesh: p,
                speed: 0.02 + Math.random() * 0.05 + (evaporationSpeed * 2),
                life: 1.0
            });
        }

        function animate() {
            requestAnimationFrame(animate);

            if (isSimulating && waterLevel > 0) {
                waterLevel -= evaporationSpeed;
                if (waterLevel < 0) waterLevel = 0;
                water.scale.y = waterLevel;

                let spawnRate = 0;
                if (tempType === 'cold') spawnRate = 0.05;
                if (tempType === 'room') spawnRate = 0.1;
                if (tempType === 'hot') spawnRate = 0.4;

                if (Math.random() < spawnRate) {
                    createParticle();
                    if(Math.random() < 0.1) playSound('bubble'); 
                }
            } else if (isSimulating && waterLevel <= 0) {
                finishSim();
            }

            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.mesh.position.y += p.speed;
                p.mesh.position.x += Math.sin(Date.now() * 0.001 + i) * 0.01;
                p.life -= 0.01;
                p.mesh.material.opacity = p.life;

                if (p.life <= 0) {
                    scene.remove(p.mesh);
                    particles.splice(i, 1);
                }
            }

            renderer.render(scene, camera);
        }

        // --- 4. å¯¦é©—æ§åˆ¶é‚è¼¯ ---

        function startSim(type) {
            if (isSimulating && waterLevel > 0) return;
            
            resetSimLogic();
            isSimulating = true;
            tempType = type;

            let speed = 0;
            let bgColor = 0xffffff;
            let speechText = "";

            if (type === 'cold') {
                speed = 0.001;
                bgColor = 0xe1f5fe;
                speechText = "ä¾å®¶å¥½ä¼¼å†¬å¤©å’å‡ã€‚å•²æ°´è’¸ç™¼å¾—å¥½æ…¢ã€‚";
                document.getElementById('main-title').innerText = "â„ï¸ å¯’å†·å˜…å†¬å¤©...";
            } else if (type === 'room') {
                speed = 0.005;
                bgColor = 0xe8f5e9;
                speechText = "å‘¢å€‹ä¿‚å¸¸æº«ï¼Œå¥½ä¼¼å–ºèª²å®¤å…¥é¢å’ã€‚å•²æ°´æœƒæ…¢æ…¢è®Šå°‘ã€‚";
                document.getElementById('main-title').innerText = "ğŸ  æº«æš–å˜…æˆ¿é–“...";
            } else if (type === 'hot') {
                speed = 0.02;
                bgColor = 0xfff3e0;
                speechText = "å¥½ç†±å‘€ï¼å¥½ä¼¼å¤å¤©å˜…å¤§å¤ªé™½å’ï¼å•²æ°´èµ°å¾—å¥½å¿«ï¼";
                document.getElementById('main-title').innerText = "â˜€ï¸ ç‚ç†±å˜…å¤å¤©ï¼";
            }

            evaporationSpeed = speed;
            scene.background = new THREE.Color(bgColor);

            // UI æ›´æ–°
            document.querySelectorAll('.temp-btn').forEach(el => el.style.display = 'none');
            document.getElementById('sim-reset-btn').style.display = 'flex';
            
            speak(speechText);
            playSound('start');
        }

        function finishSim() {
            isSimulating = false;
            
            // é¡¯ç¤ºç¸½çµè³‡è¨Š
            const modal = document.getElementById('summary-modal');
            const summaryText = document.getElementById('summary-text');
            
            let conclusion = "";
            let speech = "";
            
            if(tempType === 'hot') {
                conclusion = "å› ç‚ºå¥½ç†±ï¼Œæ°´å¥½å¿«å°±è®Šæˆæ°´è’¸æ°£å•¦ï¼";
                speech = "å˜©ï¼å› ç‚ºå¥½ç†±ï¼Œå•²æ°´å¥½å¿«å°±å…¨éƒ¨è®Šæˆæ°´è’¸æ°£å•¦ï¼";
            } else if(tempType === 'cold') {
                conclusion = "é›–ç„¶å¥½å‡ï¼Œæ°´éƒ½ä¿‚æœƒæ…¢æ…¢è®Šæ°´è’¸æ°£ï¼";
                speech = "é›–ç„¶å¥½å‡ï¼Œä½†ä¿‚å•²æ°´éƒ½ä¿‚æœƒæ…¢æ…¢è®Šæˆæ°´è’¸æ°£æ¶ï¼";
            } else {
                conclusion = "æ°´è®Šæˆçœ‹ä¸è¦‹çš„æ°´è’¸æ°£ï¼Œè·‘åˆ°ç©ºæ°£è£¡äº†ï¼";
                speech = "ä½ è¦ºå””è¦ºå‘€ï¼Ÿå•²æ°´è®Šæˆç‡å””è¦‹å˜…æ°´è’¸æ°£ï¼Œè·‘å’—å…¥ç©ºæ°£è£¡é¢å•¦ï¼";
            }
            
            summaryText.innerText = conclusion;
            modal.style.display = 'block';
            document.getElementById('sim-reset-btn').style.display = 'none';
            
            playSound('success');
            speak(speech);
        }

        function resetSim() {
            resetSimLogic();
            
            // UI é‡ç½®
            document.getElementById('summary-modal').style.display = 'none';
            document.getElementById('quiz-modal').style.display = 'none';
            document.getElementById('result-modal').style.display = 'none';
            document.getElementById('sim-reset-btn').style.display = 'none';
            document.querySelectorAll('.temp-btn').forEach(el => el.style.display = 'flex');
            
            document.getElementById('main-title').innerText = "ğŸ’§ æ°´å»å’—é‚Šåº¦ï¼Ÿ";
            scene.background = new THREE.Color(0xe0f7fa);
            speak("æˆ‘å“‹å†è©¦ä¸€æ¬¡å•¦ï¼æ€ä¸€å€‹æº«åº¦ã€‚");
        }

        function resetSimLogic() {
            isSimulating = false;
            waterLevel = 1.0;
            water.scale.y = 1;
            particles.forEach(p => scene.remove(p.mesh));
            particles = [];
            currentQuizIndex = 0;
            quizScore = 0;
        }

        // --- 5. æ¸¬é©—é‚è¼¯ ---

        function startQuiz() {
            document.getElementById('summary-modal').style.display = 'none';
            document.getElementById('quiz-modal').style.display = 'block';
            currentQuizIndex = 0;
            quizScore = 0;
            showQuestion();
            speak("æˆ‘å“‹åšŸç©å€‹å°éŠæˆ²å•¦ï¼æ€å‡ºå•±å˜…ç­”æ¡ˆï¼");
        }

        function showQuestion() {
            if(currentQuizIndex >= quizData.length) {
                finishQuiz();
                return;
            }

            const data = quizData[currentQuizIndex];
            document.getElementById('quiz-progress').innerText = `å•é¡Œ ${currentQuizIndex + 1} / 4  (${data.level})`;
            document.getElementById('quiz-question').innerText = data.q;
            
            const optionsDiv = document.getElementById('quiz-options');
            optionsDiv.innerHTML = "";
            document.getElementById('quiz-feedback').innerText = "";

            data.options.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'quiz-option';
                btn.innerText = opt.text;
                btn.onclick = () => checkAnswer(btn, opt.correct, data.feedback);
                optionsDiv.appendChild(btn);
            });
            
            // è®€å‡ºé¡Œç›®
            setTimeout(() => speak(data.q), 500);
        }

        function checkAnswer(btn, isCorrect, feedbackText) {
            // é˜²æ­¢é‡è¤‡é»æ“Š
            const allBtns = document.querySelectorAll('.quiz-option');
            allBtns.forEach(b => b.onclick = null);

            if(isCorrect) {
                btn.classList.add('correct');
                document.getElementById('quiz-feedback').style.color = 'green';
                document.getElementById('quiz-feedback').innerText = "âœ… ç­”å•±å•¦ï¼" + feedbackText;
                playSound('correct');
                speak("ç­”å•±å•¦ï¼" + feedbackText);
                quizScore++;
                
                setTimeout(() => {
                    currentQuizIndex++;
                    showQuestion();
                }, 3000);
            } else {
                btn.classList.add('wrong');
                document.getElementById('quiz-feedback').style.color = 'red';
                document.getElementById('quiz-feedback').innerText = "âŒ å””ä¿‚å–”ï¼Œè©¦å¤šæ¬¡å•¦ï¼";
                playSound('wrong');
                speak("å””ä¿‚å–”ï¼Œå†è©¦å¤šæ¬¡å•¦ï¼");
                
                // éŒ¯èª¤å¾Œå¯ä»¥é‡è©¦
                setTimeout(() => {
                    btn.classList.remove('wrong');
                    // æ¢å¾©é»æ“Š
                    const data = quizData[currentQuizIndex];
                    const opts = document.querySelectorAll('.quiz-option');
                    opts.forEach((b, idx) => {
                        b.onclick = () => checkAnswer(b, data.options[idx].correct, data.feedback);
                    });
                }, 2000);
            }
        }

        function finishQuiz() {
            document.getElementById('quiz-modal').style.display = 'none';
            document.getElementById('result-modal').style.display = 'block';
            
            const resultText = document.getElementById('result-text');
            resultText.innerText = `ä½ å®Œæˆå’—æ¸¬é©—å•¦ï¼ä½ çœŸä¿‚ä¸€å€‹å‡ºè‰²å˜…å°å°ç§‘å­¸å®¶ï¼`;
            
            playSound('success');
            speak("å¤ªå¥½å•¦ï¼ä½ å®Œæˆå’—æ‰€æœ‰é¡Œç›®ï¼ŒçœŸä¿‚å¥½å»å‘€ï¼");
        }


        // --- 6. èªéŸ³èˆ‡éŸ³æ•ˆ ---
        let voices = [];
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = () => {
                voices = window.speechSynthesis.getVoices();
            };
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                
                if (voices.length === 0) voices = window.speechSynthesis.getVoices();
                const cantoneseVoice = voices.find(v => v.lang.includes('zh-HK') || v.lang === 'yue-Hant-HK');
                
                if (cantoneseVoice) {
                    utterance.voice = cantoneseVoice;
                    utterance.lang = 'zh-HK';
                } else {
                    utterance.lang = 'zh-TW'; 
                }

                utterance.rate = 0.95;
                utterance.pitch = 1.1;
                window.speechSynthesis.speak(utterance);
            }
        }

        // éŸ³æ•ˆ
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'start') {
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.3);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'success') {
                // Do-Mi-So-Do
                playNote(523.25, 0); 
                playNote(659.25, 0.1); 
                playNote(783.99, 0.2);
                playNote(1046.5, 0.4);
            } else if (type === 'correct') {
                // å®å’š (å…©è²)
                playNote(659.25, 0); // Mi
                playNote(1046.5, 0.15); // High Do
            } else if (type === 'wrong') {
                // ä½æ²‰çš„ buzz
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'bubble') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200 + Math.random()*200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            }
        }

        function playNote(freq, delay) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0, audioCtx.currentTime + delay);
            gain.gain.linearRampToValueAtTime(0.2, audioCtx.currentTime + delay + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + delay + 0.4);
            osc.start(audioCtx.currentTime + delay);
            osc.stop(audioCtx.currentTime + delay + 0.4);
        }

        init();

    </script>
</body>
</html>